<?php declare(strict_types=1);

/**
 * This code was auto-generated by {this script}[https://github.com/cucumber/common/blob/main/messages/jsonschema/scripts/codegen.rb]
 */

namespace Cucumber\Messages;

use \JsonSerializable;

/**
 * Represents the Envelope message in Cucumber's message protocol
 * @see https://github.com/cucumber/common/tree/main/messages#readme
 *
 * When removing a field, replace it with reserved, rather than deleting the line.
 * When adding a field, add it to the end and increment the number by one.
 * See https://developers.google.com/protocol-buffers/docs/proto#updating for details
 * 
 * All the messages that are passed between different components/processes are Envelope
 * messages. */
final class Envelope implements JsonSerializable
{
    use JsonEncodingTrait;

    private function __construct(

        public readonly ?Attachment $attachment,

        public readonly ?GherkinDocument $gherkinDocument,

        public readonly ?Hook $hook,

        public readonly ?Meta $meta,

        public readonly ?ParameterType $parameterType,

        public readonly ?ParseError $parseError,

        public readonly ?Pickle $pickle,

        public readonly ?Source $source,

        public readonly ?StepDefinition $stepDefinition,

        public readonly ?TestCase $testCase,

        public readonly ?TestCaseFinished $testCaseFinished,

        public readonly ?TestCaseStarted $testCaseStarted,

        public readonly ?TestRunFinished $testRunFinished,

        public readonly ?TestRunStarted $testRunStarted,

        public readonly ?TestStepFinished $testStepFinished,

        public readonly ?TestStepStarted $testStepStarted,

        public readonly ?UndefinedParameterType $undefinedParameterType,

    ){}

    /**
     * @throws SchemaViolationException
     *
     * @internal
     */
    public static function fromArray(array $arr) : self
    {
        self::ensureAttachment($arr);
        self::ensureGherkinDocument($arr);
        self::ensureHook($arr);
        self::ensureMeta($arr);
        self::ensureParameterType($arr);
        self::ensureParseError($arr);
        self::ensurePickle($arr);
        self::ensureSource($arr);
        self::ensureStepDefinition($arr);
        self::ensureTestCase($arr);
        self::ensureTestCaseFinished($arr);
        self::ensureTestCaseStarted($arr);
        self::ensureTestRunFinished($arr);
        self::ensureTestRunStarted($arr);
        self::ensureTestStepFinished($arr);
        self::ensureTestStepStarted($arr);
        self::ensureUndefinedParameterType($arr);

        return new self(
            isset($arr['attachment']) ? Attachment::fromArray($arr['attachment']) : null,
            isset($arr['gherkinDocument']) ? GherkinDocument::fromArray($arr['gherkinDocument']) : null,
            isset($arr['hook']) ? Hook::fromArray($arr['hook']) : null,
            isset($arr['meta']) ? Meta::fromArray($arr['meta']) : null,
            isset($arr['parameterType']) ? ParameterType::fromArray($arr['parameterType']) : null,
            isset($arr['parseError']) ? ParseError::fromArray($arr['parseError']) : null,
            isset($arr['pickle']) ? Pickle::fromArray($arr['pickle']) : null,
            isset($arr['source']) ? Source::fromArray($arr['source']) : null,
            isset($arr['stepDefinition']) ? StepDefinition::fromArray($arr['stepDefinition']) : null,
            isset($arr['testCase']) ? TestCase::fromArray($arr['testCase']) : null,
            isset($arr['testCaseFinished']) ? TestCaseFinished::fromArray($arr['testCaseFinished']) : null,
            isset($arr['testCaseStarted']) ? TestCaseStarted::fromArray($arr['testCaseStarted']) : null,
            isset($arr['testRunFinished']) ? TestRunFinished::fromArray($arr['testRunFinished']) : null,
            isset($arr['testRunStarted']) ? TestRunStarted::fromArray($arr['testRunStarted']) : null,
            isset($arr['testStepFinished']) ? TestStepFinished::fromArray($arr['testStepFinished']) : null,
            isset($arr['testStepStarted']) ? TestStepStarted::fromArray($arr['testStepStarted']) : null,
            isset($arr['undefinedParameterType']) ? UndefinedParameterType::fromArray($arr['undefinedParameterType']) : null,
        );
    }

    /**
     * Check that the type of 'attachment' matches expectations
     *
     * @psalm-assert array{attachment?: array} $arr
     */
    private static function ensureAttachment(array $arr): void
    {
        if (array_key_exists('attachment', $arr) && !is_array($arr['attachment'])) {
            throw new SchemaViolationException('Property \'attachment\' was not array');
        }
    }

    /**
     * Check that the type of 'gherkinDocument' matches expectations
     *
     * @psalm-assert array{gherkinDocument?: array} $arr
     */
    private static function ensureGherkinDocument(array $arr): void
    {
        if (array_key_exists('gherkinDocument', $arr) && !is_array($arr['gherkinDocument'])) {
            throw new SchemaViolationException('Property \'gherkinDocument\' was not array');
        }
    }

    /**
     * Check that the type of 'hook' matches expectations
     *
     * @psalm-assert array{hook?: array} $arr
     */
    private static function ensureHook(array $arr): void
    {
        if (array_key_exists('hook', $arr) && !is_array($arr['hook'])) {
            throw new SchemaViolationException('Property \'hook\' was not array');
        }
    }

    /**
     * Check that the type of 'meta' matches expectations
     *
     * @psalm-assert array{meta?: array} $arr
     */
    private static function ensureMeta(array $arr): void
    {
        if (array_key_exists('meta', $arr) && !is_array($arr['meta'])) {
            throw new SchemaViolationException('Property \'meta\' was not array');
        }
    }

    /**
     * Check that the type of 'parameterType' matches expectations
     *
     * @psalm-assert array{parameterType?: array} $arr
     */
    private static function ensureParameterType(array $arr): void
    {
        if (array_key_exists('parameterType', $arr) && !is_array($arr['parameterType'])) {
            throw new SchemaViolationException('Property \'parameterType\' was not array');
        }
    }

    /**
     * Check that the type of 'parseError' matches expectations
     *
     * @psalm-assert array{parseError?: array} $arr
     */
    private static function ensureParseError(array $arr): void
    {
        if (array_key_exists('parseError', $arr) && !is_array($arr['parseError'])) {
            throw new SchemaViolationException('Property \'parseError\' was not array');
        }
    }

    /**
     * Check that the type of 'pickle' matches expectations
     *
     * @psalm-assert array{pickle?: array} $arr
     */
    private static function ensurePickle(array $arr): void
    {
        if (array_key_exists('pickle', $arr) && !is_array($arr['pickle'])) {
            throw new SchemaViolationException('Property \'pickle\' was not array');
        }
    }

    /**
     * Check that the type of 'source' matches expectations
     *
     * @psalm-assert array{source?: array} $arr
     */
    private static function ensureSource(array $arr): void
    {
        if (array_key_exists('source', $arr) && !is_array($arr['source'])) {
            throw new SchemaViolationException('Property \'source\' was not array');
        }
    }

    /**
     * Check that the type of 'stepDefinition' matches expectations
     *
     * @psalm-assert array{stepDefinition?: array} $arr
     */
    private static function ensureStepDefinition(array $arr): void
    {
        if (array_key_exists('stepDefinition', $arr) && !is_array($arr['stepDefinition'])) {
            throw new SchemaViolationException('Property \'stepDefinition\' was not array');
        }
    }

    /**
     * Check that the type of 'testCase' matches expectations
     *
     * @psalm-assert array{testCase?: array} $arr
     */
    private static function ensureTestCase(array $arr): void
    {
        if (array_key_exists('testCase', $arr) && !is_array($arr['testCase'])) {
            throw new SchemaViolationException('Property \'testCase\' was not array');
        }
    }

    /**
     * Check that the type of 'testCaseFinished' matches expectations
     *
     * @psalm-assert array{testCaseFinished?: array} $arr
     */
    private static function ensureTestCaseFinished(array $arr): void
    {
        if (array_key_exists('testCaseFinished', $arr) && !is_array($arr['testCaseFinished'])) {
            throw new SchemaViolationException('Property \'testCaseFinished\' was not array');
        }
    }

    /**
     * Check that the type of 'testCaseStarted' matches expectations
     *
     * @psalm-assert array{testCaseStarted?: array} $arr
     */
    private static function ensureTestCaseStarted(array $arr): void
    {
        if (array_key_exists('testCaseStarted', $arr) && !is_array($arr['testCaseStarted'])) {
            throw new SchemaViolationException('Property \'testCaseStarted\' was not array');
        }
    }

    /**
     * Check that the type of 'testRunFinished' matches expectations
     *
     * @psalm-assert array{testRunFinished?: array} $arr
     */
    private static function ensureTestRunFinished(array $arr): void
    {
        if (array_key_exists('testRunFinished', $arr) && !is_array($arr['testRunFinished'])) {
            throw new SchemaViolationException('Property \'testRunFinished\' was not array');
        }
    }

    /**
     * Check that the type of 'testRunStarted' matches expectations
     *
     * @psalm-assert array{testRunStarted?: array} $arr
     */
    private static function ensureTestRunStarted(array $arr): void
    {
        if (array_key_exists('testRunStarted', $arr) && !is_array($arr['testRunStarted'])) {
            throw new SchemaViolationException('Property \'testRunStarted\' was not array');
        }
    }

    /**
     * Check that the type of 'testStepFinished' matches expectations
     *
     * @psalm-assert array{testStepFinished?: array} $arr
     */
    private static function ensureTestStepFinished(array $arr): void
    {
        if (array_key_exists('testStepFinished', $arr) && !is_array($arr['testStepFinished'])) {
            throw new SchemaViolationException('Property \'testStepFinished\' was not array');
        }
    }

    /**
     * Check that the type of 'testStepStarted' matches expectations
     *
     * @psalm-assert array{testStepStarted?: array} $arr
     */
    private static function ensureTestStepStarted(array $arr): void
    {
        if (array_key_exists('testStepStarted', $arr) && !is_array($arr['testStepStarted'])) {
            throw new SchemaViolationException('Property \'testStepStarted\' was not array');
        }
    }

    /**
     * Check that the type of 'undefinedParameterType' matches expectations
     *
     * @psalm-assert array{undefinedParameterType?: array} $arr
     */
    private static function ensureUndefinedParameterType(array $arr): void
    {
        if (array_key_exists('undefinedParameterType', $arr) && !is_array($arr['undefinedParameterType'])) {
            throw new SchemaViolationException('Property \'undefinedParameterType\' was not array');
        }
    }
}
