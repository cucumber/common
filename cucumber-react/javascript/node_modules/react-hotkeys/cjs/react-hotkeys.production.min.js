/**
 * ISC License
 *
 * Copyright (c) 2018, Aleck Greenham
 *
 * Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * PLEASE NOTE: SOURCE CODE FOUND IN THE lib/vendor DIRECTORY IS UNDER THE MIT LICENSE - PLEASE SEE THE LICENSE FILE FOR EACH DIRECTORY FOR MORE INFORMATION
 */

"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var PropTypes=_interopDefault(require("prop-types")),React=require("react"),React__default=_interopDefault(React);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _objectWithoutProperties(e,t){if(null==e)return{};var n,i,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function dictionaryFrom(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return e.reduce(function(e,t){return e[t]=n||{value:t},e},{})}var _defaultConfiguration={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],enableHardSequences:!1,ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(e){var t=e.target;if(t&&t.tagName){var n=t.tagName.toLowerCase();return Configuration.option("_ignoreTagsDict")[n]||t.isContentEditable}return!1},simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0},_configuration=_objectSpread({},_defaultConfiguration);_configuration._ignoreTagsDict=dictionaryFrom(_configuration.ignoreTags,!0);var Configuration=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"init",value:function(t){var n=this;t.ignoreTags&&(t._ignoreTagsDict=dictionaryFrom(t.ignoreTags)),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach(function(e){n.set(e,t[e])})}},{key:"set",value:function(e,t){_configuration[e]=t}},{key:"reset",value:function(e){_configuration[e]=_defaultConfiguration[e]}},{key:"option",value:function(e){return _configuration[e]}}]),e}(),Logger=function(){function n(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";_classCallCheck(this,n),_defineProperty(this,"verbose",this.noop),_defineProperty(this,"debug",this.noop),_defineProperty(this,"info",this.noop),_defineProperty(this,"warn",this.noop),_defineProperty(this,"error",this.noop),this.logLevel=this.constructor.levels[e],this.logLevel>=this.constructor.levels.error&&(this.error=console.error,this.logLevel>=this.constructor.levels.warn&&(this.warn=console.warn,["info","debug","verbose"].some(function(e){return!(t.logLevel>=t.constructor.levels[e])||(t[e]=console.log,!1)})))}return _createClass(n,[{key:"noop",value:function(){}}]),n}();function isUndefined(e){return void 0===e}_defineProperty(Logger,"logIcons",["üìï","üìó","üìò","üìô"]),_defineProperty(Logger,"componentIcons",["üî∫","‚≠êÔ∏è","üî∑","üî∂","‚¨õÔ∏è"]),_defineProperty(Logger,"eventIcons",["‚ù§Ô∏è","üíö","üíô","üíõ","üíú","üß°"]),_defineProperty(Logger,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var KeyEventBitmapManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"newBitmap",value:function(e){var t=[!1,!1,!1];if(!isUndefined(e))for(var n=0;n<=e;n++)t[n]=!0;return t}},{key:"setBit",value:function(e,t){return e[t]=!0,e}},{key:"clone",value:function(e){for(var t=this.newBitmap(),n=0;n<e.length;n++)t[n]=e[n];return t}},{key:"and",value:function(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=e[i]&t[i];return n}}]),e}(),KeyEventBitmapIndex={keydown:0,keypress:1,keyup:2},ShiftedKeysDictionary={"`":["~"],1:["!"],2:["@",'"'],3:["#","¬£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function resolveShiftedAlias(e){return ShiftedKeysDictionary[e]||[1===e.length?e.toUpperCase():e]}function hasKey(e,t){return e.hasOwnProperty(t)}function invertArrayDictionary(e){return Object.keys(e).reduce(function(t,n){return e[n].forEach(function(e){hasKey(t,e)||(t[e]=[]),t[e].push(n)}),t},{})}var UnshiftedKeysDictionary=invertArrayDictionary(ShiftedKeysDictionary);function resolveUnshiftedAlias(e){return UnshiftedKeysDictionary[e]||[1===e.length?e.toLowerCase():e]}var KeyOSAndLayoutAliasesDictionary={Backspace:["Delete"]};function isString(e){return"string"==typeof e}function stripSuperfluousWhitespace(e){return isString(e)?e.trim().replace(/\s+/g," "):e}var MousetrapToReactKeyNamesDictionary={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Backspace",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},KeyShorthandDictionary={cmd:"Meta"};function standardizeKeyName(e){var t=e.toLowerCase();return MousetrapToReactKeyNamesDictionary[t]||KeyShorthandDictionary[t]||(e.match(/^f\d+$/)?e.toUpperCase():e)}var SpecialKeysDictionary={Shift:!0,Control:!0,Alt:!0,Meta:!0,Enter:!0,Tab:!0,CapsLock:!0,BackSpace:!0,Escape:!0};function isSpecialKey(e){return!!SpecialKeysDictionary[e]}function isValidKey(e){return isSpecialKey(e)||String.fromCharCode(e.charCodeAt(0))===e}var InvalidKeyNameError=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,_wrapNativeSuper(Error)),t}();function normalizedCombinationId(e){return e.sort().join("+")}var KeySequenceParser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=stripSuperfluousWhitespace(e).split(" ");try{var i=t.slice(0,t.length-1),o=t[t.length-1],r=i.map(function(e){var t=parseCombination(e,n);return normalizedCombinationId(Object.keys(t))}).join(" "),s=parseCombination(o,n),a={id:normalizedCombinationId(Object.keys(s)),keyDictionary:s,eventBitmapIndex:n.eventBitmapIndex,size:Object.keys(s).length};return{sequence:{prefix:r,size:i.length+1},combination:a}}catch(e){return{sequence:null,combination:null}}}}]),e}();function parseCombination(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce(function(e,t){var n=standardizeKeyName(t);if(i.ensureValidKeys&&!isValidKey(n))throw new InvalidKeyNameError;return e[n]=!0,e},{})}var AltedKeysDictionary={"`":["`"],1:["¬°"],2:["‚Ñ¢"],3:["¬£"],4:["¬¢"],5:["‚àû"],6:["¬ß"],7:["¬∂"],8:["‚Ä¢"],9:["¬™"],0:["¬∫"],"-":["‚Äì"],"=":["‚â†"],a:["√•"],b:["‚à´"],c:["√ß"],d:["‚àÇ"],e:["¬¥"],f:["∆í"],g:["¬©"],h:["Àô"],i:["ÀÜ"],j:["‚àÜ"],k:["Àö"],l:["¬¨"],m:["¬µ"],n:["Àú"],o:["√∏"],p:["œÄ"],q:["≈ì"],r:["¬Æ"],s:["√ü"],t:["‚Ä†"],u:["¬®"],v:["‚àö"],w:["‚àë"],x:["‚âà"],y:["¬•"],z:["Œ©"],"[":["‚Äú"],"]":["‚Äò"],"\\":["¬´"],"'":["√¶"],";":["‚Ä¶"],",":["‚â§"],".":["‚â•"],"/":["√∑"]},UnaltedKeysDictionary=invertArrayDictionary(AltedKeysDictionary);function resolveUnaltedAlias(e){return UnaltedKeysDictionary[e]||[e]}function resolveAltedAlias(e){return AltedKeysDictionary[e]||[e]}var AltShiftedKeysDictionary={"`":["`"],1:["‚ÅÑ"],2:["‚Ç¨"],3:["‚Äπ"],4:["‚Ä∫"],5:["Ô¨Å"],6:["Ô¨Ç"],7:["‚Ä°"],8:["¬∞"],9:["¬∑"],0:["‚Äö"],"-":["‚Äî"],"=":["¬±"],a:["√Ö"],b:["ƒ±"],c:["√á"],d:["√é"],e:["¬¥"],f:["√è"],g:["Àù"],h:["√ì"],i:["ÀÜ"],j:["√î"],k:["Ô£ø"],l:["√í"],m:["√Ç"],n:["Àú"],o:["√ò"],p:["œÄ"],q:["≈í"],r:["‚Ä∞"],s:["√ç"],t:["√é"],u:["¬®"],v:["‚óä"],w:["‚Äû"],x:["Àõ"],y:["√Å"],z:["¬∏"],"[":["‚Äù"],"]":["‚Äô"],"\\":["¬ª"],"'":["√Ü"],";":["√ö"],",":["¬Ø"],".":["Àò"]},UnaltShiftedKeysDictionary=invertArrayDictionary(AltShiftedKeysDictionary);function resolveUnaltShiftedAlias(e){return UnaltShiftedKeysDictionary[e]||resolveUnshiftedAlias(e)}function resolveAltShiftedAlias(e){return AltShiftedKeysDictionary[e]||[e]}var KeyCombinationSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"serialize",value:function(e){var c=e.Shift,y=e.Alt,p={};return Object.keys(e).sort().forEach(function(e){var n=[];if(c)if(y){var t=resolveUnaltShiftedAlias(e),i=resolveAltShiftedAlias(e);n=[].concat(_toConsumableArray(n),[e],_toConsumableArray(t),_toConsumableArray(i))}else{var o=resolveUnshiftedAlias(e),r=resolveShiftedAlias(e);n=[].concat(_toConsumableArray(n),[e],_toConsumableArray(o),_toConsumableArray(r))}else if(y){var s=resolveUnaltedAlias(e),a=resolveAltedAlias(e);n=[].concat(_toConsumableArray(n),[e],_toConsumableArray(s),_toConsumableArray(a))}else{n.push(e);var u=KeyOSAndLayoutAliasesDictionary[e];u&&(n=[].concat(_toConsumableArray(n),_toConsumableArray(u)))}var l=Object.keys(p);0<l.length?l.forEach(function(t){n.forEach(function(e){p[t+"+".concat(e)]=_objectSpread({},p[t],_defineProperty({},e,!0))}),delete p[t]}):n.forEach(function(e){p[e]=_defineProperty({},e,!0)})}),Object.values(p).map(function(e){return Object.keys(e).sort().join("+")})}},{key:"isValidKeySerialization",value:function(e){return 0<e.length&&!!KeySequenceParser.parse(e,{ensureValidKeys:!0}).combination}}]),e}();function arrayFrom(e){return Array.isArray(e)?e:e?[e]:[]}function indexFromEnd(e,t){return e[e.length-(t+1)]}function isObject(e){return!Array.isArray(e)&&"object"===_typeof(e)&&null!==e}function isEmpty(e){return isObject(e)?0===Object.keys(e).length:!e||0===e.length}function describeKeyEventType(e){switch(parseInt(e,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}var KeyEventSequenceIndex={previous:0,current:1};function resolveKeyAlias(e){return KeyOSAndLayoutAliasesDictionary[e]||[e]}var ModifierFlagsDictionary={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]};function without(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=dictionaryFrom(arrayFrom(e));return Array.isArray(n)?n.reduce(function(e,t){return o[t]&&(i.stringifyFirst||o[t].value===t)||e.push(t),e},[]):isObject(n)?Object.keys(n).reduce(function(e,t){return o[t]||(e[t]=n[t]),e},{}):n}for(var KeysWithoutPressEventDictionary={Shift:!0,Control:!0,Alt:!0,Meta:!0,Enter:!0,Tab:!0,BackSpace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},i=1;i<13;i++)KeysWithoutPressEventDictionary["F".concat(i)]=!0;function hasKeyPressEvent(e){return!KeysWithoutPressEventDictionary[e]}var AbstractKeyEventStrategy=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;_classCallCheck(this,n),this.logger=e.logger||new Logger("warn"),this.componentId=-1,this.keyEventManager=t,this.keyMapRegistry={},this.componentRegistry={},this.rootComponentId=null,this._reset(),this._resetKeyCombinationHistory()}return _createClass(n,[{key:"_reset",value:function(){this._initRegisteredKeyMapsState(),this._initHandlerResolutionState()}},{key:"_initRegisteredKeyMapsState",value:function(){this.componentList=[],this.longestSequence=1,this.longestSequenceComponentIndex=null,this.keyMapEventBitmap=KeyEventBitmapManager.newBitmap(),this.componentIdDict={}}},{key:"_initHandlerResolutionState",value:function(){this.keyMaps=null,this.handlerResolutionSearchIndex=0,this.unmatchedHandlerStatus=null,this.handlersDictionary={},this.keySequencesDictionary={}}},{key:"_resetKeyCombinationHistory",value:function(){if(this.keyCombinationIncludesKeyUp=!1,this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[],!this.keyCombinationHistory||this.keyCombinationHistory.length<1)this.keyCombinationHistory=[];else{var o=this._getCurrentKeyCombination(),e=Object.keys(o.keys).reduce(function(e,t){var n=o.keys[t],i=n[KeyEventSequenceIndex.current];return i[KeyEventBitmapIndex.keydown]&&!i[KeyEventBitmapIndex.keyup]&&(e[t]=n),e},{});this.keyCombinationHistory=[{keys:e,ids:KeyCombinationSerializer.serialize(e)}]}}},{key:"getApplicationKeyMap",value:function(){return null===this.rootComponentId?{}:this._buildApplicationKeyMap([this.rootComponentId],{})}},{key:"_buildApplicationKeyMap",value:function(e,o){var n=this;return e.forEach(function(e){var t=n.componentRegistry[e],i=n.keyMapRegistry[e];i&&Object.keys(i).forEach(function(n){o[n]=[],arrayFrom(i[n]).forEach(function(e){var t=isObject(e)?e.sequence:e;o[n].push(t)})}),n._buildApplicationKeyMap(t.childIds,o)}),o}},{key:"registerKeyMap",value:function(e){return this.componentId+=1,this.keyMapRegistry[this.componentId]=e,this.componentRegistry[this.componentId]=newComponentRegistryItem(),this.componentId}},{key:"reregisterKeyMap",value:function(e,t){this.keyMapRegistry[e]=t}},{key:"registerComponentMount",value:function(e,t){isUndefined(t)?this.rootComponentId=e:(this.componentRegistry[e].parentId=t,this.componentRegistry[t].childIds.push(e))}},{key:"deregisterKeyMap",value:function(e){var t=this.componentRegistry[e].parentId,n=this.componentRegistry[t];n&&(n.childIds=without(n.childIds,e)),delete this.componentRegistry[e],delete this.keyMapRegistry[e],e===this.rootComponentId&&(this.rootComponentId=null)}},{key:"_addComponentToList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=this._buildComponentOptions(e,t,n,i);this.componentList.push(o),this._setComponentPosition(e,this.componentList.length-1)}},{key:"_buildComponentOptions",value:function(e,t,n,i){var o=this._applyHardSequences(t,n),r=o.keyMap,s=o.handlers;return{actions:this._buildActionDictionary(_objectSpread({},t,r),i,e),handlers:s,componentId:e,options:i}}},{key:"_applyHardSequences",value:function(n,i){return Configuration.option("enableHardSequences")?Object.keys(i).reduce(function(e,t){return!!!n[t]&&KeyCombinationSerializer.isValidKeySerialization(t)&&(e.keyMap[t]=t),e.handlers[t]=i[t],e},{keyMap:{},handlers:{}}):{keyMap:n,handlers:i}}},{key:"_buildActionDictionary",value:function(e,l,c){var y=this;return Object.keys(e).reduce(function(a,u){return arrayFrom(e[u]).forEach(function(n){var e=function(){if(isObject(n)){var e=n.sequence,t=n.action;return{keySequence:e,eventBitmapIndex:isUndefined(t)?KeyEventBitmapIndex[l.defaultKeyEvent]:KeyEventBitmapIndex[t]}}return{keySequence:n,eventBitmapIndex:KeyEventBitmapIndex[l.defaultKeyEvent]}}(),t=e.keySequence,i=e.eventBitmapIndex,o=KeySequenceParser.parse(t,{eventBitmapIndex:i}),r=o.sequence,s=o.combination;r.size>y.longestSequence&&(y.longestSequence=r.size,y.longestSequenceComponentIndex=c),KeyEventBitmapManager.setBit(y.keyMapEventBitmap,i),a[u]||(a[u]=[]),a[u].push(_objectSpread({prefix:r.prefix,actionName:u,sequenceLength:r.size},s))}),a},{})}},{key:"_getCurrentKeyCombination",value:function(){return 0<this.keyCombinationHistory.length?this.keyCombinationHistory[this.keyCombinationHistory.length-1]:{keys:{},ids:[""],keyAliases:{}}}},{key:"_addToCurrentKeyCombination",value:function(e,t){0===this.keyCombinationHistory.length&&this.keyCombinationHistory.push({keys:{},ids:[""],keyAliases:{}});var n=this._getCurrentKeyCombination(),i=getKeyAlias(n,e),o=getKeyState(n,e);n.keys[i]=o?[KeyEventBitmapManager.clone(o[1]),KeyEventBitmapManager.newBitmap(t)]:[KeyEventBitmapManager.newBitmap(),KeyEventBitmapManager.newBitmap(t)],n.ids=KeyCombinationSerializer.serialize(n.keys),n.keyAliases=this._buildCombinationKeyAliases(n.keys),t===KeyEventBitmapIndex.keyup&&(this.keyCombinationIncludesKeyUp=!0)}},{key:"_startNewKeyCombination",value:function(e,t){this.keyCombinationHistory.length>this.longestSequence&&this.keyCombinationHistory.shift();var n=this._getCurrentKeyCombination(),i=_objectSpread({},this._withoutKeyUps(n),_defineProperty({},e,[KeyEventBitmapManager.newBitmap(),KeyEventBitmapManager.newBitmap(t)]));this.keyCombinationHistory.push({keys:i,ids:KeyCombinationSerializer.serialize(i),keyAliases:this._buildCombinationKeyAliases(i)}),this.keyCombinationIncludesKeyUp=!1}},{key:"_withoutKeyUps",value:function(i){return Object.keys(i.keys).reduce(function(e,t){var n=i.keys[t];return n[KeyEventSequenceIndex.current][KeyEventBitmapIndex.keyup]||(e[t]=n),e},{})}},{key:"_shouldSimulate",value:function(e,t){var n=hasKeyPressEvent(t);return e===KeyEventBitmapIndex.keypress?!n||n&&this._keyIsCurrentlyDown("Meta"):e===KeyEventBitmapIndex.keyup&&(n&&keyIsCurrentlyTriggeringEvent(this._getCurrentKeyState("Meta"),KeyEventBitmapIndex.keyup))}},{key:"_cloneAndMergeEvent",value:function(n,e){return _objectSpread({},Object.keys(ModifierFlagsDictionary).reduce(function(e,t){return e[t]=n[t],e},{}),e)}},{key:"_callMatchingHandlerClosestToEventTarget",value:function(e,t,n,i,o){var d=this;for(this.keyMaps&&this.unmatchedHandlerStatus||(this.keyMaps=[],this.unmatchedHandlerStatus=[],this.componentList.forEach(function(e){var t=e.handlers;d.unmatchedHandlerStatus.push([Object.keys(t).length,{}]),d.keyMaps.push({})}));o<=i;){var r=this.unmatchedHandlerStatus[o][0];if(0<r)for(var s=function(){var e=d.componentList[d.handlerResolutionSearchIndex],t=e.handlers,i=e.actions;Object.keys(t).forEach(function(e){d.handlersDictionary[e]||(d.handlersDictionary[e]=[]),d.handlersDictionary[e].push(d.handlerResolutionSearchIndex)}),Object.keys(i).forEach(function(n){var e=d.handlersDictionary[n];if(e){var c=e[0],y=d.componentList[c].handlers[n],p=d.keyMaps[c];p.sequences||(p.sequences={}),i[n].forEach(function(t){var e=[t.prefix,t.id].join(" ");if(!(d.keySequencesDictionary[e]&&d.keySequencesDictionary[e].some(function(e){return e[1]===t.eventBitmapIndex}))){p.sequences[t.prefix]||(p.sequences[t.prefix]={combinations:{}});var n=t.prefix,i=t.sequenceLength,o=t.id,r=t.keyDictionary,s=t.size,a=t.eventBitmapIndex,u=t.actionName,l=p.sequences[t.prefix].combinations[t.id];p.sequences[t.prefix].combinations[t.id]=l?_objectSpread({},l,{events:_objectSpread({},l.events,_defineProperty({},a,{actionName:u,eventBitmapIndex:a,handler:y}))}):{prefix:n,sequenceLength:i,id:o,keyDictionary:r,size:s,events:_defineProperty({},a,{actionName:u,eventBitmapIndex:a,handler:y})},p.eventBitmap||(p.eventBitmap=KeyEventBitmapManager.newBitmap()),KeyEventBitmapManager.setBit(p.eventBitmap,t.eventBitmapIndex),(!p.longestSequence||p.longestSequence<t.sequenceLength)&&(p.longestSequence=t.sequenceLength),d.keySequencesDictionary[e]||(d.keySequencesDictionary[e]=[]),d.keySequencesDictionary[e].push([c,t.eventBitmapIndex])}}),e.forEach(function(e){var t=d.unmatchedHandlerStatus[e];t[1][n]||(t[1][n]=!0,t[0]--)})}}),d.handlerResolutionSearchIndex++};this.handlerResolutionSearchIndex<this.componentList.length&&0<r;)s();var a=this.keyMaps[o];if(a&&!isEmpty(a.sequences)&&a.eventBitmap[n])for(var u=a.sequences,l=a.longestSequence,c=this._getCurrentKeyCombination(),y=getKeyAlias(c,t),p=l;0<=p;){var h=this.keyCombinationHistory.slice(-p,-1).map(function(e){return e.ids}),v=this._tryMatchSequenceWithKeyAliases(u,h);if(v){v.order||function(){var n=Object.values(v.combinations).reduce(function(e,t){var n=t.id,i=t.size;return e[i]||(e[i]=[]),e[i].push(n),e},{});v.order=Object.keys(n).sort(function(e,t){return t-e}).reduce(function(e,t){return e.concat(n[t])},[])}();for(var f=v.order,g=0;g<f.length;){var _=f[g],m=v.combinations[_];if(this._combinationMatchesKeys(y,c,m,n)){KeyCombinationSerializer.serialize(m.keyDictionary);return m.events[n].handler(e),this._stopEventPropagationAfterHandlingIfEnabled(e,o),!0}g++}}p--}else;o++}}},{key:"_stopEventPropagationAfterHandlingIfEnabled",value:function(e,t){return!!Configuration.option("stopEventPropagationAfterHandling")&&(this._stopEventPropagation(e,t),!0)}},{key:"_stopEventPropagationAfterIgnoringIfEnabled",value:function(e,t){return!!Configuration.option("stopEventPropagationAfterIgnoring")&&(this._stopEventPropagation(e,t),!0)}},{key:"_describeCurrentKeyCombination",value:function(){return this._getCurrentKeyCombination().ids[0]}},{key:"_tryMatchSequenceWithKeyAliases",value:function(e,n){if(0===n.length)return e[""];for(var t=n.map(function(e){return e.length}),i=n.map(function(){return 0}),o=!1;!o;){var r=i.map(function(e,t){return n[t][e]}).join(" ");if(e[r])return e[r];for(var s=0,a=!0;a&&s<i.length;){var u=(indexFromEnd(i,s)+1)%(indexFromEnd(t,s)||1);(a=0===(i[i.length-(s+1)]=u))&&s++}o=s===i.length}}},{key:"_combinationMatchesKeys",value:function(n,i,e,o){if(!e.events[o])return!1;var r=!1;return!Object.keys(e.keyDictionary).some(function(e){var t=getKeyState(i,e);return!t||(!keyIsCurrentlyTriggeringEvent(t,o)||(n&&n===getKeyAlias(i,e)&&(r=!keyAlreadyTriggeredEvent(t,o)),!1))})&&r}},{key:"_checkForModifierFlagDiscrepancies",value:function(i){var o=this;Object.keys(ModifierFlagsDictionary).forEach(function(t){var n=o._keyIsCurrentlyDown(t);ModifierFlagsDictionary[t].forEach(function(e){!1===i[e]&&n&&o._addToCurrentKeyCombination(t,KeyEventBitmapIndex.keyup)})})}},{key:"_keyIsCurrentlyDown",value:function(e){var t=this._getCurrentKeyState(e);return!!(keyIsCurrentlyTriggeringEvent(t,KeyEventBitmapIndex.keypress)&&!keyIsCurrentlyTriggeringEvent(t,KeyEventBitmapIndex.keyup))}},{key:"_getCurrentKeyState",value:function(e){return getKeyState(this._getCurrentKeyCombination(),e)}},{key:"_buildCombinationKeyAliases",value:function(t){var e=function(){if(t.Shift)return t.Alt?[resolveAltShiftedAlias,resolveUnaltShiftedAlias]:[resolveShiftedAlias,resolveUnshiftedAlias];if(t.Alt)return[resolveAltedAlias,resolveUnaltedAlias];var e=function(e){return[e]};return[e,e]}();return Object.keys(t).reduce(function(n,i){return resolveKeyAlias(i).forEach(function(t){e.forEach(function(e){e(t).forEach(function(e){e===i&&i===t||(n[e]=i)})})}),n},{})}},{key:"_setComponentPosition",value:function(e,t){this.componentIdDict[e]=t}},{key:"_getComponentPosition",value:function(e){return this.componentIdDict[e]}},{key:"_getComponent",value:function(e){var t=this._getComponentPosition(e);return this.componentList[t]}},{key:"_getComponentAndPosition",value:function(e){var t=this._getComponentPosition(e);return[this.componentList[t],t]}},{key:"_logPrefix",value:function(){}}]),n}();function keyIsCurrentlyTriggeringEvent(e,t){return e&&e[KeyEventSequenceIndex.current][t]}function getKeyAlias(e,t){if(e.keys[t])return t;var n=e.keyAliases[t];return n||t}function getKeyState(e,t){var n=e.keys[t];if(n)return n;var i=e.keyAliases[t];return i?e.keys[i]:void 0}function newComponentRegistryItem(){return{childIds:[],parentId:null}}function keyAlreadyTriggeredEvent(e,t){return e&&e[KeyEventSequenceIndex.previous][t]}var KeyEventCounter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getId",value:function(){return isUndefined(this.id)&&(this.id=0),this.id}},{key:"incrementId",value:function(){this.id=this.getId()+1}}]),e}();function normalizeKeyName(e){return"+"===e?"plus":e}function isCmdKey(e){return"Meta"===e}var EventResponse={unseen:0,ignored:1,seen:2,recorded:3,handled:4},FocusOnlyKeyEventStrategy=function(e){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return _classCallCheck(this,i),(e=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,t,n))).focusTreeId=0,e.currentEvent={key:null,type:null,handled:!1,ignored:!1},e}return _inherits(i,AbstractKeyEventStrategy),_createClass(i,[{key:"_reset",value:function(){_get(_getPrototypeOf(i.prototype),"_reset",this).call(this),this.keypressEventsToSimulate=[],this.focusTreeId+=1,this._clearEventPropagationState()}},{key:"_clearEventPropagationState",value:function(){this.eventPropagationState={previousComponentPosition:-1,actionHandled:!1,ignoreEvent:!1,forceObserveEvent:!1,stopping:!1}}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;(this.resetOnNextFocus||this.keyMaps)&&(this._reset(),this.resetOnNextFocus=!1),this._addComponentToList(e,t,n,i);this._getComponent(e);return this.focusTreeId}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=4<arguments.length?arguments[4]:void 0,r=this._getComponentPosition(t);if(e===this.focusTreeId&&!isUndefined(r)){this.componentList[r]=this._buildComponentOptions(t,n,i,o);this._getComponent(t)}}},{key:"disableHotKeys",value:function(e,t){this.resetOnNextFocus||(this.resetOnNextFocus=!0);var n=this._getComponentPosition(t),i=this.eventPropagationState.previousComponentPosition;return-1!==i&&i+1<n}},{key:"handleKeydown",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=normalizeKeyName(e.key);if(t!==this.focusTreeId)return this._ignoreEvent(e,n),!0;this._howToHandleKeyDownEvent(e,t,n,o,i,KeyEventBitmapIndex.keydown)===EventResponse.handled&&(!!this._getCurrentKeyState(o)||this.keyCombinationIncludesKeyUp?this._startAndLogNewKeyCombination(o,KeyEventBitmapIndex.keydown,t,n):this._addToAndLogCurrentKeyCombination(o,KeyEventBitmapIndex.keydown,t,n),this._callHandlerIfActionNotHandled(e,o,KeyEventBitmapIndex.keydown,n,t));return this._simulateKeyPressesMissingFromBrowser(e,o,t,n,i),this._updateEventPropagationHistory(n),!1}},{key:"_howToHandleKeyDownEvent",value:function(e,t,n,i,o,r){if(this._shouldIgnoreEvent())return this._ignoreEvent(e,n),EventResponse.ignored;if(this._isNewKeyEvent(n)){if(this._setNewEventParameters(e,r),this._setIgnoreEventFlag(e,o),this._shouldIgnoreEvent())return this._ignoreEvent(e,n),EventResponse.ignored;this._checkForModifierFlagDiscrepancies(e)}return EventResponse.handled}},{key:"handleKeypress",value:function(e,t,n,i){var o=normalizeKeyName(e.key),r=t!==this.focusTreeId,s=this._howToHandleKeyDownEvent(e,t,n,o,i,KeyEventBitmapIndex.keypress);return this._isNewKeyEvent(n)&&this._getCurrentKeyState(o)&&this._addToAndLogCurrentKeyCombination(o,KeyEventBitmapIndex.keypress,t,n),s===EventResponse.handled&&this._callHandlerIfActionNotHandled(e,o,KeyEventBitmapIndex.keypress,n,t),this._updateEventPropagationHistory(n),r}},{key:"handleKeyup",value:function(e,t,n,i){var o=normalizeKeyName(e.key),r=t!==this.focusTreeId,s=this._howToHandleKeyDownEvent(e,t,n,o,i,KeyEventBitmapIndex.keyup);return this._isNewKeyEvent(n)&&this._getCurrentKeyState(o)&&this._addToAndLogCurrentKeyCombination(o,KeyEventBitmapIndex.keyup,t,n),s===EventResponse.handled&&this._callHandlerIfActionNotHandled(e,o,KeyEventBitmapIndex.keyup,n,t),this._simulateKeyUpEventsHiddenByCmd(e,o,t,n,i),this._updateEventPropagationHistory(n),r}},{key:"_simulateKeyPressesMissingFromBrowser",value:function(e,t,n,i,o){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",this._shouldSimulate(KeyEventBitmapIndex.keypress,t),{event:e,key:t,focusTreeId:n,componentId:i,options:o})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,i,o){var r=this;isCmdKey(e)&&Object.keys(this._getCurrentKeyCombination().keys).forEach(function(e){isCmdKey(e)||r._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",r._shouldSimulate(KeyEventBitmapIndex.keyup,e),{event:t,key:e,focusTreeId:n,componentId:i,options:o})})}},{key:"_ignoreEvent",value:function(e,t){this.currentEvent.ignored=!0,this._stopEventPropagationAfterIgnoringIfEnabled(e,t)?this._updateEventPropagationHistory(t,{forceReset:!0}):this._updateEventPropagationHistory(t)}},{key:"_shouldIgnoreEvent",value:function(){var e=this.eventPropagationState,t=e.ignoreEvent;return!e.forceObserveEvent&&t}},{key:"_isNewKeyEvent",value:function(e){var t=this.eventPropagationState.previousComponentPosition;return-1===t||t>=this._getComponentPosition(e)}},{key:"_updateEventPropagationHistory",value:function(e){(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{forceReset:!1}).forceReset||this._isFocusTreeRoot(e)?this._clearEventPropagationState():this.eventPropagationState.previousComponentPosition=this._getComponentPosition(e)}},{key:"_setIgnoreEventFlag",value:function(e,t){this.eventPropagationState.ignoreEvent=t.ignoreEventsCondition(e)}},{key:"ignoreEvent",value:function(){this.eventPropagationState.ignoreEvent=!0}},{key:"forceObserveEvent",value:function(){this.eventPropagationState.forceObserveEvent=!0}},{key:"_isFocusTreeRoot",value:function(e){return this._getComponentPosition(e)>=this.componentList.length-1}},{key:"_setNewEventParameters",value:function(e,t){KeyEventCounter.incrementId(),this.currentEvent={key:e.key,type:t,handled:!1,ignored:!1}}},{key:"_startAndLogNewKeyCombination",value:function(e,t,n,i){this._startNewKeyCombination(e,t)}},{key:"_addToAndLogCurrentKeyCombination",value:function(e,t,n,i){this._addToCurrentKeyCombination(e,t)}},{key:"_stopEventPropagation",value:function(e,t){this.eventPropagationState.stopping||(this.eventPropagationState.stopping=!0,e.simulated||e.stopPropagation())}},{key:"_handleEventSimulation",value:function(e,t,n,i){var o=i.event,r=i.key,s=i.focusTreeId,a=i.componentId,u=i.options;if(n&&Configuration.option("simulateMissingKeyPressEvents")){var l=this._cloneAndMergeEvent(o,{key:r,simulated:!0});this[e].push({event:l,focusTreeId:s,componentId:a,options:u})}(this._isFocusTreeRoot(a)||this.eventPropagationState.stopping)&&(this.keyEventManager.isGlobalListenersBound()||this[t]())}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeypress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyup")}},{key:"_simulatePendingKeyEvents",value:function(e,r){var s=this;0<this[e].length&&KeyEventCounter.incrementId(),this[e].forEach(function(e){var t=e.event,n=e.focusTreeId,i=e.componentId,o=e.options;s[r](t,n,i,o)}),this[e]=[],this._clearEventPropagationState()}},{key:"_callHandlerIfActionNotHandled",value:function(e,t,n,i,o){this._describeCurrentKeyCombination();if(this.keyMapEventBitmap[n])if(this.eventPropagationState.actionHandled);else{var r=this.eventPropagationState.previousComponentPosition,s=this._getComponentPosition(i);this._callMatchingHandlerClosestToEventTarget(e,t,n,s,-1===r?0:r)&&(this.eventPropagationState.actionHandled=!0,this.currentEvent.handled=!0)}}},{key:"_logPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=Logger.logIcons,i=Logger.eventIcons,o=Logger.componentIcons,r="HotKeys (";if(!1!==t.focusTreeId){var s=isUndefined(t.focusTreeId)?this.focusTreeId:t.focusTreeId;r+="F".concat(s).concat(n[s%n.length],"-")}if(!1!==t.eventId){var a=isUndefined(t.eventId)?KeyEventCounter.getId():t.eventId;r+="E".concat(a).concat(i[a%i.length],"-")}r+="C".concat(e).concat(o[e%o.length]);var u=this._getComponentPosition(e);return isUndefined(u)||(r+="-P".concat(u).concat(o[u%o.length],":")),"".concat(r,")")}}]),i}();function capitalize(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}function removeAtIndex(e,t){return[].concat(_toConsumableArray(e.slice(0,t)),_toConsumableArray(e.slice(t+1)))}function getEventCharCode(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,10===t&&(t=13),32<=t||13===t?t:0}var normalizeKey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},translateToKey={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function getEventKey(e){if(e.key){var t=normalizeKey[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"!==e.type)return"keydown"===e.type||"keyup"===e.type?translateToKey[e.keyCode]||"Unidentified":"";var n=getEventCharCode(e);return 13===n?"Enter":String.fromCharCode(n)}function contains(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(e)||isString(e)?n.stringifyFirst?!isUndefined(e.find(function(e){return e.toString()===t.toString()})):-1!==e.indexOf(t):isObject(e)?hasKey(e,t):n.stringifyFirst?e.toString()===t.toString():e===t}var GlobalKeyEventStrategy=function(e){function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return _classCallCheck(this,o),(e=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,t,n))).listenersBound=!1,e.eventOptions={ignoreEventsCondition:Configuration.option("ignoreEventsCondition")},e}return _inherits(o,AbstractKeyEventStrategy),_createClass(o,[{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;this.eventOptions=o,this._addComponentToList(e,t,n,i),this._updateDocumentHandlers()}},{key:"updateEnabledHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;this.eventOptions=o;var r=this._getComponentPosition(e);this.componentList[r]=this._buildComponentOptions(e,t,n,i),this._updateLongestKeySequenceIfNecessary(e),this._updateDocumentHandlers(),this._initHandlerResolutionState()}},{key:"disableHotKeys",value:function(e){var t=_slicedToArray(this._getComponentAndPosition(e),2),n=t[0].keyMapEventBitmap,i=t[1];this.componentList=removeAtIndex(this.componentList,i),this._updateLongestKeySequenceIfNecessary(e),this._updateComponentIndexDictFromList({startingAt:i}),this._updateDocumentHandlers(n,KeyEventBitmapManager.newBitmap()),this._initHandlerResolutionState()}},{key:"_updateLongestKeySequenceIfNecessary",value:function(e){var n=this;e===this.longestSequenceComponentIndex&&(this.longestSequence=1,this.componentList.forEach(function(e){var t=e.longestSequence;t>n.longestSequence&&(n.longestSequence=t)}))}},{key:"_updateComponentIndexDictFromList",value:function(){for(var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{startingAt:0}).startingAt;e<this.componentList.length;)this._setComponentPosition(this.componentList[e].componentId,e),e++}},{key:"_updateDocumentHandlers",value:function(){var n=this,e=this.keyMapEventBitmap.some(function(e){return e});if(!this.listenersBound&&e){for(var t=function(e){var t=describeKeyEventType(e);document["on".concat(t)]=function(e){n.keyEventManager["handleGlobal".concat(capitalize(t))](e)}},i=0;i<this.keyMapEventBitmap.length;i++)t(i);this.listenersBound=!0}else if(this.listenersBound&&!e){for(i=0;i<this.keyMapEventBitmap.length;i++){var o=describeKeyEventType(i);delete document["on".concat(o)]}this.listenersBound=!1}}},{key:"handleKeydown",value:function(e){this._checkForModifierFlagDiscrepancies(e);var t=normalizeKeyName(getEventKey(e)),n=this._howReactAppRespondedTo(e,t,KeyEventBitmapIndex.keydown);if(n!==EventResponse.unseen||!this.eventOptions.ignoreEventsCondition(e)){if(n!==EventResponse.ignored)!!this._getCurrentKeyState(t)||this.keyCombinationIncludesKeyUp?this._startAndLogNewKeyCombination(t,KeyEventBitmapIndex.keydown):this._addToAndLogCurrentKeyCombination(t,KeyEventBitmapIndex.keydown);contains([EventResponse.ignored,EventResponse.handled],n)||this._callHandlerIfExists(e,t,KeyEventBitmapIndex.keydown),this._simulateKeyPressesMissingFromBrowser(e,t)}}},{key:"_howReactAppRespondedTo",value:function(e,t,n){var i=this.keyEventManager.reactAppHistoryWithEvent(t,n);switch(i){case EventResponse.handled:case EventResponse.ignored:case EventResponse.seen:break;default:KeyEventCounter.incrementId()}return i}},{key:"handleKeypress",value:function(e){var t=normalizeKeyName(getEventKey(e)),n=this._howReactAppRespondedTo(e,t,KeyEventBitmapIndex.keypress);this._getCurrentKeyState(t)&&this._addToAndLogCurrentKeyCombination(t,KeyEventBitmapIndex.keypress),n===EventResponse.unseen&&this.eventOptions.ignoreEventsCondition(e)||contains([EventResponse.ignored,EventResponse.handled],n)||this._callHandlerIfExists(e,t,KeyEventBitmapIndex.keypress)}},{key:"handleKeyup",value:function(e){var t=normalizeKeyName(getEventKey(e)),n=this._howReactAppRespondedTo(e,t,KeyEventBitmapIndex.keyup);this._getCurrentKeyState(t)&&this._addToAndLogCurrentKeyCombination(t,KeyEventBitmapIndex.keyup),n===EventResponse.unseen&&this.eventOptions.ignoreEventsCondition(e)||contains([EventResponse.ignored,EventResponse.handled],n)||this._callHandlerIfExists(e,t,KeyEventBitmapIndex.keyup),this._simulateKeyUpEventsHiddenByCmd(e,t)}},{key:"_simulateKeyPressesMissingFromBrowser",value:function(e,t){this.keyEventManager.simulatePendingKeyPressEvents(),this._handleEventSimulation("handleKeypress",this._shouldSimulate(KeyEventBitmapIndex.keypress,t),{event:e,key:t})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;isCmdKey(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),Object.keys(this._getCurrentKeyCombination().keys).forEach(function(e){isCmdKey(e)||n._handleEventSimulation("handleKeyup",n._shouldSimulate(KeyEventBitmapIndex.keyup,e),{event:t,key:e})}))}},{key:"_startAndLogNewKeyCombination",value:function(e,t){this._startNewKeyCombination(e,t)}},{key:"_addToAndLogCurrentKeyCombination",value:function(e,t){this._addToCurrentKeyCombination(e,t)}},{key:"_handleEventSimulation",value:function(e,t,n){var i=n.event,o=n.key;if(t&&Configuration.option("simulateMissingKeyPressEvents")){var r=this._cloneAndMergeEvent(i,{key:o,simulated:!0});this[e](r)}}},{key:"_callHandlerIfExists",value:function(e,t,n){this._describeCurrentKeyCombination();this.keyMapEventBitmap[n]&&this._callMatchingHandlerClosestToEventTarget(e,t,n)}},{key:"_callMatchingHandlerClosestToEventTarget",value:function(e,t,n){for(var i=0;i<this.componentList.length;i++){if(_get(_getPrototypeOf(o.prototype),"_callMatchingHandlerClosestToEventTarget",this).call(this,e,t,n,i,0))return}}},{key:"_stopEventPropagation",value:function(e,t){e.simulated||e.stopPropagation()}},{key:"_logPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=Logger.eventIcons,i=Logger.componentIcons,o="HotKeys (GLOBAL";if(!1!==t.eventId){var r=isUndefined(t.eventId)?KeyEventCounter.getId():t.eventId;o="".concat(o,"-E").concat(r).concat(n[r%n.length])}return isUndefined(e)?"".concat(o,"):"):"".concat(o,"-C").concat(e).concat(i[e%i.length],"):")}}]),o}();function isFromFocusOnlyComponent(e){return!isUndefined(e)}var KeyEventManager=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.logger=e.logger||new Logger(Configuration.option("logLevel")),this._focusOnlyEventStrategy=new FocusOnlyKeyEventStrategy({configuration:e,logger:this.logger},this),this._globalEventStrategy=new GlobalKeyEventStrategy({configuration:e,logger:this.logger},this)}return _createClass(t,null,[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.instance||(this.instance=new t(e)),this.instance}},{key:"clear",value:function(){delete this.instance}}]),_createClass(t,[{key:"getApplicationKeyMap",value:function(){return Object.assign(this._globalEventStrategy.getApplicationKeyMap(),this._focusOnlyEventStrategy.getApplicationKeyMap())}},{key:"registerKeyMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._focusOnlyEventStrategy.registerKeyMap(e)}},{key:"reregisterKeyMap",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._focusOnlyEventStrategy.reregisterKeyMap(e,t)}},{key:"deregisterKeyMap",value:function(e){this._focusOnlyEventStrategy.deregisterKeyMap(e)}},{key:"registerComponentMount",value:function(e,t){return this._focusOnlyEventStrategy.registerComponentMount(e,t)}},{key:"registerGlobalKeyMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._globalEventStrategy.registerKeyMap(e)}},{key:"registerGlobalComponentMount",value:function(e,t){return this._globalEventStrategy.registerComponentMount(e,t)}},{key:"reregisterGlobalKeyMap",value:function(e,t){this._globalEventStrategy.reregisterKeyMap(e,t)}},{key:"deregisterGlobalKeyMap",value:function(e){this._globalEventStrategy.deregisterKeyMap(e)}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;return this._focusOnlyEventStrategy.enableHotKeys(e,t,n,i)}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=4<arguments.length?arguments[4]:void 0;return this._focusOnlyEventStrategy.updateEnabledHotKeys(e,t,n,i,o)}},{key:"disableHotKeys",value:function(e,t){return this._focusOnlyEventStrategy.disableHotKeys(e,t)}},{key:"handleKeydown",value:function(e,t,n,i){if(isFromFocusOnlyComponent(t))return this._focusOnlyEventStrategy.handleKeydown(e,t,n,i)}},{key:"handleKeypress",value:function(e,t,n,i){if(isFromFocusOnlyComponent(t))return this._focusOnlyEventStrategy.handleKeypress(e,t,n,i)}},{key:"handleKeyup",value:function(e,t,n,i){if(isFromFocusOnlyComponent(t))return this._focusOnlyEventStrategy.handleKeyup(e,t,n,i)}},{key:"enableGlobalHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.enableHotKeys(e,t,n,i,o)}},{key:"updateEnabledGlobalHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.updateEnabledHotKeys(e,t,n,i,o)}},{key:"disableGlobalHotKeys",value:function(e){return this._globalEventStrategy.disableHotKeys(e)}},{key:"handleGlobalKeydown",value:function(e){return this._globalEventStrategy.handleKeydown(e)}},{key:"handleGlobalKeypress",value:function(e){return this._globalEventStrategy.handleKeypress(e)}},{key:"handleGlobalKeyup",value:function(e){return this._globalEventStrategy.handleKeyup(e)}},{key:"ignoreEvent",value:function(e){this._focusOnlyEventStrategy.ignoreEvent(e)}},{key:"forceObserveEvent",value:function(e){this._focusOnlyEventStrategy.forceObserveEvent(e)}},{key:"reactAppHistoryWithEvent",value:function(e,t){var n=this._focusOnlyEventStrategy.currentEvent;return n.key===e&&n.type===t?n.handled?EventResponse.handled:n.ignored?EventResponse.ignored:EventResponse.seen:EventResponse.unseen}},{key:"simulatePendingKeyPressEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this._globalEventStrategy.listenersBound}}]),t}();function withHotKeys(i){var e,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};function o(e,t){return _objectSpread({},n[e]||{},t[e]||{})}function r(e){return o("handlers",e)}function s(e){return o("keyMap",e)}return t=e=function(e){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)))._handleFocus=t._handleFocus.bind(_assertThisInitialized(_assertThisInitialized(t))),t._handleBlur=t._handleBlur.bind(_assertThisInitialized(_assertThisInitialized(t))),t._handleKeyDown=t._handleKeyDown.bind(_assertThisInitialized(_assertThisInitialized(t))),t._handleKeyPress=t._handleKeyPress.bind(_assertThisInitialized(_assertThisInitialized(t))),t._handleKeyUp=t._handleKeyUp.bind(_assertThisInitialized(_assertThisInitialized(t))),t._componentIsFocused=t._componentIsFocused.bind(_assertThisInitialized(_assertThisInitialized(t))),t._id=KeyEventManager.getInstance().registerKeyMap(e.keyMap),t}return _inherits(n,React.PureComponent),_createClass(n,[{key:"getChildContext",value:function(){return{hotKeysParentId:this._id}}},{key:"render",value:function(){var e=this.props,t=(e.keyMap,e.handlers,e.allowChanges,_objectWithoutProperties(e,["keyMap","handlers","allowChanges"])),n={onFocus:this._wrapFunction("onFocus",this._handleFocus),onBlur:this._wrapFunction("onBlur",this._handleBlur),tabIndex:Configuration.option("defaultTabIndex")};return this._shouldBindKeyListeners()&&(n.onKeyDown=this._handleKeyDown,n.onKeyPress=this._handleKeyPress,n.onKeyUp=this._handleKeyUp),React__default.createElement(i,_extends({hotKeys:n},t))}},{key:"_shouldBindKeyListeners",value:function(){var e=s(this.props);return!isEmpty(e)||Configuration.option("enableHardSequences")&&this._handlersIncludeHardSequences(e,r(this.props))}},{key:"_handlersIncludeHardSequences",value:function(t,e){return Object.keys(e).some(function(e){return!t[e]&&KeyCombinationSerializer.isValidKeySerialization(e)})}},{key:"_wrapFunction",value:function(t,n){var i=this;return"function"==typeof this.props[t]?function(e){i.props[t](e),n(e)}:n}},{key:"_focusTreeIdsPush",value:function(e){this._focusTreeIds||(this._focusTreeIds=[]),this._focusTreeIds.push(e)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds&&this._focusTreeIds.shift()}},{key:"_getFocusTreeId",value:function(){if(this._focusTreeIds)return this._focusTreeIds[0]}},{key:"componentDidUpdate",value:function(e){var t=KeyEventManager.getInstance();if(t.reregisterKeyMap(this._id,this.props.keyMap),this._componentIsFocused()&&(this.props.allowChanges||!Configuration.option("ignoreKeymapAndHandlerChangesByDefault"))){var n=this.props,i=n.keyMap,o=n.handlers;t.updateEnabledHotKeys(this._getFocusTreeId(),this._id,i,o,this._getComponentOptions())}}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"componentDidMount",value:function(){var e=KeyEventManager.getInstance(),t=this.context.hotKeysParentId;e.registerComponentMount(this._id,t)}},{key:"_handleFocus",value:function(){var e;this.props.onFocus&&(e=this.props).onFocus.apply(e,arguments);var t=KeyEventManager.getInstance().enableHotKeys(this._id,s(this.props),r(this.props),this._getComponentOptions());this._focusTreeIdsPush(t),this._focused=!0}},{key:"componentWillUnmount",value:function(){KeyEventManager.getInstance().deregisterKeyMap(this._id),this._handleBlur()}},{key:"_handleBlur",value:function(){var e;this.props.onBlur&&(e=this.props).onBlur.apply(e,arguments);KeyEventManager.getInstance().disableHotKeys(this._getFocusTreeId(),this._id)||this._focusTreeIdsShift(),this._focused=!1}},{key:"_handleKeyDown",value:function(e){KeyEventManager.getInstance().handleKeydown(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyPress",value:function(e){KeyEventManager.getInstance().handleKeypress(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyUp",value:function(e){KeyEventManager.getInstance().handleKeyup(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:Configuration.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:Configuration.option("ignoreEventsCondition")}}}]),n}(),_defineProperty(e,"propTypes",{keyMap:PropTypes.object,handlers:PropTypes.object,onFocus:PropTypes.func,onBlur:PropTypes.func,allowChanges:PropTypes.bool}),_defineProperty(e,"contextTypes",{hotKeysParentId:PropTypes.number}),_defineProperty(e,"childContextTypes",{hotKeysParentId:PropTypes.number}),t}var HotKeysWrapper=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=e.innerRef,i=e.component,o=_objectWithoutProperties(e,["hotKeys","innerRef","component"]),r=i||Configuration.option("defaultComponent");return React__default.createElement(r,_objectSpread({},t,{ref:n},o))}}]),t}(),HotKeys=withHotKeys(HotKeysWrapper);HotKeys.propTypes={innerRef:PropTypes.object};var GlobalHotKeys=function(e){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)))._id=KeyEventManager.getInstance().registerGlobalKeyMap(e.keyMap),t}return _inherits(n,React.Component),_createClass(n,[{key:"getChildContext",value:function(){return{globalHotKeysParentId:this._id}}},{key:"render",value:function(){return this.props.children||null}},{key:"componentDidUpdate",value:function(){var e=KeyEventManager.getInstance();if(e.reregisterGlobalKeyMap(this._id,this.props.keyMap),this.props.allowChanges||!Configuration.option("ignoreKeymapAndHandlerChangesByDefault")){var t=this.props,n=t.keyMap,i=t.handlers;e.updateEnabledGlobalHotKeys(this._id,n,i,this._getComponentOptions(),this._getEventOptions())}}}]),_createClass(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.keyMap,n=e.handlers,i=this.context.globalHotKeysParentId,o=KeyEventManager.getInstance();o.registerGlobalComponentMount(this._id,i),o.enableGlobalHotKeys(this._id,t,n,this._getComponentOptions(),this._getEventOptions())}},{key:"componentWillUnmount",value:function(){var e=KeyEventManager.getInstance();e.deregisterGlobalKeyMap(this._id),e.disableGlobalHotKeys(this._id)}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:Configuration.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:Configuration.option("ignoreEventsCondition")}}}]),n}();function withHotKeysIgnoreOverride(i){var e,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},o=2<arguments.length?arguments[2]:void 0;return t=e=function(e){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)))._handleKeyEvent=t._handleKeyEvent.bind(_assertThisInitialized(_assertThisInitialized(t))),t._reloadDictionaries=t._reloadDictionaries.bind(_assertThisInitialized(_assertThisInitialized(t))),t}return _inherits(n,React.PureComponent),_createClass(n,[{key:"render",value:function(){var e=this.props,t=(e.only,e.except,_objectWithoutProperties(e,["only","except"])),n={onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:this._reloadDictionaries};return React__default.createElement(i,_extends({hotKeys:n},t))}},{key:"_reloadDictionaries",value:function(){var e=this.props,t=e.only,n=e.except;this._onlyDict=keyDictionary(t),this._exceptDict=keyDictionary(n)}},{key:"_shouldIgnoreEvent",value:function(e){var t=e.key;return isEmpty(this._onlyDict)?!!isEmpty(this._exceptDict)||!this._exceptDict[t]:isEmpty(this._exceptDict)?this._onlyDict[t]:this._onlyDict[t]&&!this._exceptDict[t]}},{key:"_handleKeyEvent",value:function(e){this._shouldIgnoreEvent(e)&&KeyEventManager.getInstance()[o](e)}}]),n}(),_defineProperty(e,"propTypes",{only:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),except:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)])}),_defineProperty(e,"defaultProps",n),t}function keyDictionary(e){return arrayFrom(e).reduce(function(t,e){var n=standardizeKeyName(e);if(!isValidKey(n))throw new InvalidKeyNameError(e);return[resolveAltShiftedAlias,resolveUnaltShiftedAlias,resolveShiftedAlias,resolveUnshiftedAlias,resolveAltedAlias,resolveUnaltedAlias].forEach(function(e){t[e(n)]=!0}),t},{})}_defineProperty(GlobalHotKeys,"propTypes",{keyMap:PropTypes.object,handlers:PropTypes.object,allowChanges:PropTypes.bool}),GlobalHotKeys.contextTypes={globalHotKeysParentId:PropTypes.number},GlobalHotKeys.childContextTypes=GlobalHotKeys.contextTypes;var IgnoreKeys=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=_objectWithoutProperties(e,["hotKeys"]),i=n.component||Configuration.option("defaultComponent");return React__default.createElement(i,_objectSpread({},t,n))}}]),t}(),IgnoreKeys$1=withHotKeysIgnoreOverride(IgnoreKeys,{},"ignoreEvent"),ObserveKeys=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=_objectWithoutProperties(e,["hotKeys"]),i=n.component||Configuration.option("defaultComponent");return React__default.createElement(i,_objectSpread({},t,n))}}]),t}(),ObserveKeys$1=withHotKeysIgnoreOverride(ObserveKeys,{},"forceObserveEvent");function withIgnoreKeys(e){return withHotKeysIgnoreOverride(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"ignoreEvent")}function withObserveKeys(e){return withHotKeysIgnoreOverride(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"forceObserveEvent")}function configure(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Configuration.init(e)}function getApplicationKeyMap(){return KeyEventManager.getInstance().getApplicationKeyMap()}exports.HotKeys=HotKeys,exports.GlobalHotKeys=GlobalHotKeys,exports.IgnoreKeys=IgnoreKeys$1,exports.ObserveKeys=ObserveKeys$1,exports.withHotKeys=withHotKeys,exports.withIgnoreKeys=withIgnoreKeys,exports.withObserveKeys=withObserveKeys,exports.configure=configure,exports.getApplicationKeyMap=getApplicationKeyMap;
